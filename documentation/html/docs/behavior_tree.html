
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>behavior_tree &#8212; AFSIM 2.9.0 Documentation</title>
    <link rel="stylesheet" href="../_static/wsftheme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/collapse.css" />
    <link rel="stylesheet" type="text/css" href="../_static/admonition.css" />
    <link rel="stylesheet" type="text/css" href="../_static/table.css" />
    <link rel="stylesheet" type="text/css" href="../_static/pseudo-header.css" />
    <link rel="stylesheet" type="text/css" href="../_static/pseudo-topic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/quick-search.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/collapse_sections.js"></script>
    
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Behavior Tree Demos" href="behavior_tree_demos.html" />
    <link rel="prev" title="behavior" href="behavior.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="../wsf-classindex.html" title="Script Class Index"
             >classes</a> |</li>
        <li class="right" >
          <a href="../wsf-commandindex.html" title="Command Index"
             >commands</a> |</li>
        <li class="right" >
          <a href="../wsf-modelindex.html" title="Model Index"
             >models</a> |</li>
        <li class="right" >
          <a href="../wsf-demoindex.html" title="Demo Index"
             >demos</a> |</li>
        <li class="right" >
          <a href="behavior_tree_demos.html" title="Behavior Tree Demos"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="behavior.html" title="behavior"
             accesskey="P">previous</a> |</li>
  <li>
    <img src="../_static/relbar_logo.png" alt=""
         style="vertical-align: middle; margin-top: -2px" />
  </li>
  <li>
    <a href="main_page.html">AFSIM 2.9.0 Documentation</a> &#187;
  </li>
  
        <li class="nav-item nav-item-0"><a href="../site_index.html">Site Index</a> &#187;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="behavior-tree">
<h1>behavior_tree<a class="headerlink" href="#behavior-tree" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#connector-nodes" id="id1">Connector Nodes</a></p></li>
<li><p><a class="reference internal" href="#defining-a-behavior-tree" id="id2">Defining a behavior_tree</a></p></li>
<li><p><a class="reference internal" href="#behavior-tree-design-considerations" id="id3">Behavior Tree Design Considerations</a></p></li>
</ul>
</div>
<dl class="command">
<dt id="behavior_tree">
behavior_tree … end_behavior_tree<a class="headerlink" href="#behavior_tree" title="Permalink to this definition">¶</a></dt>
<dd><p>The Behavior Tree is an artificial intelligence technology that allows scenario developers to quickly create flexible
agents with various tactical modules, called behaviors or behavior nodes.  The nodes can be arranged together in
interesting and interrelated ways with connector nodes.</p>
<pre class="literal-block"><a class="reference internal" href="#behavior_tree">behavior_tree</a>
   &lt;one or more nodes&gt;
end_behavior_tree</pre>
<p>There are two basic node types:</p>
<ul class="simple">
<li><p><a class="reference internal" href="behavior.html#behavior" title="behavior"><span class="xref wsf wsf-command">Behavior Nodes</span></a> - the leaf nodes of the tree, contain user defined script that performs a particular
behavior or action.  See the <a class="reference internal" href="behavior.html#behavior" title="behavior"><span class="xref wsf wsf-command">behavior</span></a> page for more info.</p></li>
<li><p>Connector Nodes - useful for building &amp; organizing the tree. These nodes specify how behavior nodes are related to
each other.</p></li>
</ul>
</dd></dl>

<section id="connector-nodes">
<h2><a class="toc-backref" href="#id1">Connector Nodes</a><a class="headerlink" href="#connector-nodes" title="Permalink to this headline">¶</a></h2>
<p><em>Connector Node Structure &amp; Syntax</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">connector</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="nb">type</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="n">run_selection</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">make_selection</span> <span class="o">...</span><span class="p">]</span>
  <span class="o">&lt;</span><span class="n">two</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">nodes</span><span class="o">&gt;</span>
<span class="n">end_</span><span class="o">&lt;</span><span class="n">connector</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="nb">type</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Currently, there are five supported connector-node-types:  <a class="reference internal" href="#sequence">sequence</a>,  <a class="reference internal" href="#parallel">parallel</a>,  <a class="reference internal" href="#selector">selector</a>,
<a class="reference internal" href="#priority_selector">priority_selector</a>,  and <a class="reference internal" href="#weighted_random">weighted_random</a></p>
<p>If it’s not clear from the syntax definition above, any node on the behavior tree can have any number of child nodes
(either connector or behavior type).  These child nodes can subsequently have any number and type of children as well,
and so on.  Two of the connector node types perform a sequence of sorts and can not make use of any modifiers, however
there are three connector nodes types that perform a single child selection (selector, priority_selector, and
weighted_random) and these can be further specialized by using the sub-commands <a class="reference internal" href="#run_selection">run_selection</a> and <a class="reference internal" href="#make_selection">make_selection</a> .</p>
<dl class="command">
<dt id="behavior_tree.sequence">
<span id="sequence"></span>sequence … end_sequence<a class="headerlink" href="#behavior_tree.sequence" title="Permalink to this definition">¶</a></dt>
<dd><p>Sequence nodes are the 2nd most common connector node used in behavior trees.  When a sequence node is reached, it
executes all of its children in order, until one of the children fails its precondition.  If the first child fails,
then none of the children are executed.  If all children pass their preconditions, they are all executed.  If the first
half of the children pass and the next node fails, then the first half of the children are all executed, and the
second half are not.</p>
</dd></dl>

<dl class="command">
<dt id="behavior_tree.parallel">
<span id="parallel"></span>parallel … end_parallel<a class="headerlink" href="#behavior_tree.parallel" title="Permalink to this definition">¶</a></dt>
<dd><p>Parallel nodes are connector nodes used in the behavior tree in order to execute every one of their children that
passes precondition, regardless of ordering.</p>
</dd></dl>

<dl class="command">
<dt id="behavior_tree.selector">
<span id="selector"></span>selector … end_selector<a class="headerlink" href="#behavior_tree.selector" title="Permalink to this definition">¶</a></dt>
<dd><p>Selector nodes are the most common connector node used in behavior trees.  A selector node dictates the tree to choose
only one of its children to execute.  The tree will execute the first child of a selector node that passes its
precondition.</p>
</dd></dl>

<dl class="command">
<dt id="behavior_tree.priority_selector">
<span id="priority_selector"></span>priority_selector … end_priority_selector<a class="headerlink" href="#behavior_tree.priority_selector" title="Permalink to this definition">¶</a></dt>
<dd><p>Priority-Selector nodes are connector nodes used in the behavior tree in order to choose and execute whichever child is
highest valued.  The value of a child is determined by its precondition script block.  Priority-Selector nodes always
(and only) execute their highest valued child.</p>
</dd></dl>

<dl class="command">
<dt id="behavior_tree.weighted_random">
<span id="weighted_random"></span>weighted_random … end_weighted_random<a class="headerlink" href="#behavior_tree.weighted_random" title="Permalink to this definition">¶</a></dt>
<dd><p>Weighted-Random nodes are connector nodes used in the behavior tree in order to randomly choose and execute a child.  A
uniform weighted random selection is performed, and the weights for each child are determined by their precondition
script blocks.  For example, if a Weighted-Random node has two children and both return a value of “3”, then they are
equally likely to be chosen.  It will be common for Weighted-Random nodes to use the “run_selection” feature, in order
to allow their selected child to execute for a while (or until done) before another random selection is made.</p>
</dd></dl>

<dl class="command">
<dt id="behavior_tree.&lt;connector">
<span id="<connector"></span>&lt;connector node sub-commands&gt;<a class="headerlink" href="#behavior_tree.<connector" title="Permalink to this definition">¶</a></dt>
<dd><p><em>(only useful for types: selector, priority_selector, and weighted_random)</em></p>
<dl class="command">
<dt id="behavior_tree.run_selection">
<span id="run_selection"></span>run_selection [ until_done | for<em> &lt;time&gt;</em> | repeat<em> &lt;int&gt;</em> ]<a class="headerlink" href="#behavior_tree.run_selection" title="Permalink to this definition">¶</a></dt>
<dd><p>Specify how long a selected child will be executed for, rather than the default: once (repeat 1).  If “until_done” is
declared, then a child node will be executed until its precondition returns 0.0 or false.</p>
</dd></dl>

<dl class="command">
<dt id="behavior_tree.make_selection">
<span id="make_selection"></span>make_selection [ continuous | count<em> &lt;int&gt;</em> ]<a class="headerlink" href="#behavior_tree.make_selection" title="Permalink to this definition">¶</a></dt>
<dd><p>Specify how many selections will be made, rather than the default: continuous.  This doesn’t affect or change whatever
is defined by make_selection, but rather it could limit how many times a selector type node will perform.</p>
</dd></dl>

<p>For example, this tree defined below will randomly select between behaviors “cat” and “dog” with probability of
selection at 67% and 33%, respectively (because of their precondition return values).  Each time a selection is made,
the node will be run automatically on each update for 30 seconds rather than new selections being made each update
(because of the run_selection command).  The weighted_random node will only make selections ten times and then it won’t
do anything after that (because of the make_selection command).  So this tree will only be doing something for
approximately 300 seconds (30 sec times 10).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">behavior</span> <span class="n">cat</span> <span class="n">precondition</span> <span class="k">return</span> <span class="mf">2.0</span> <span class="n">end_precondition</span> <span class="n">execute</span> <span class="n">writeln</span><span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">);</span> <span class="n">end_execute</span> <span class="n">end_behavior</span>
<span class="n">behavior</span> <span class="n">dog</span> <span class="n">precondition</span> <span class="k">return</span> <span class="mf">1.0</span> <span class="n">end_precondition</span> <span class="n">execute</span> <span class="n">writeln</span><span class="p">(</span><span class="s2">&quot;dog&quot;</span><span class="p">);</span> <span class="n">end_execute</span> <span class="n">end_behavior</span>
<span class="n">behavior_tree</span>
  <span class="n">weighted_random</span>
    <span class="n">run_selection</span> <span class="k">for</span> <span class="mi">30</span> <span class="n">sec</span>
    <span class="n">make_selection</span> <span class="n">count</span> <span class="mi">10</span>
    <span class="n">behavior_node</span> <span class="n">cat</span>
    <span class="n">behavior_node</span> <span class="n">dog</span>
  <span class="n">end_weighted_random</span>
<span class="n">end_behavior_tree</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="defining-a-behavior-tree">
<h2><a class="toc-backref" href="#id2">Defining a behavior_tree</a><a class="headerlink" href="#defining-a-behavior-tree" title="Permalink to this headline">¶</a></h2>
<p>By default, the behavior tree has an invisible root node that is a parallel node.  All behaviors, and all nodes that
exist at the root level will all be checked for preconditions and executed if the preconditions passed.</p>
<p><code class="docutils literal notranslate"><span class="pre">behavior_tree</span> <span class="pre">...</span> <span class="pre">end_behavior_tree</span></code></p>
<p>Behavior trees can contain [theoretically] and infinite depth of nested connector nodes and behaviors.  Here is an
example of a behavior tree that doesn’t use any connector nodes, and has a depth of one, by attaching only behavior
nodes themselves to the [invisible] root node of the tree.</p>
<p><em>Example Shallow Behavior Tree</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># all these named behaviors are assumed to be pre-defined</span>
<span class="n">behavior_tree</span>
   <span class="n">behavior_node</span> <span class="n">check_fuel</span>
   <span class="n">behavior_node</span> <span class="n">check_instruments</span>
   <span class="n">behavior_node</span> <span class="n">drink_coffee</span>
<span class="n">end_behavior_tree</span>
</pre></div>
</div>
<p><em>Example Simple Behavior Tree</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sequences over the &quot;check_fuel&quot; and &quot;check_instruments&quot; behaviors every update</span>
<span class="n">behavior_tree</span>
   <span class="n">sequence</span>
      <span class="n">behavior_node</span>  <span class="n">check_fuel</span>
      <span class="n">behavior_node</span>  <span class="n">check_instruments</span>
   <span class="n">end_sequence</span>
<span class="n">end_behavior_tree</span>
</pre></div>
</div>
<p><em>Example Nested Behavior Tree</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># all these named behaviors are assumed to be pre-defined</span>
<span class="n">behavior_tree</span>
  <span class="n">sequence</span>
    <span class="n">behavior_node</span> <span class="n">drink_coffee</span>
    <span class="n">selector</span>
      <span class="n">behavior_node</span> <span class="n">check_fuel</span>
      <span class="n">behavior_node</span> <span class="n">check_instruments</span>
    <span class="n">end_selector</span>
  <span class="n">end_sequence</span>
<span class="n">end_behavior_tree</span>
</pre></div>
</div>
</section>
<section id="behavior-tree-design-considerations">
<h2><a class="toc-backref" href="#id3">Behavior Tree Design Considerations</a><a class="headerlink" href="#behavior-tree-design-considerations" title="Permalink to this headline">¶</a></h2>
<p>The two main considerations of the tree builder are the preconditions of behavior nodes and the placement of nodes in
the tree.  These two considerations working together decide which nodes of a behavior tree execute. The precondition is
an internal check a node does to determine if it can even run.  The position of a node in the behavior tree acts as an
“external check” to determine whether or not it will run.  For example, if a node is a child of a selector node and
other child nodes are often selected, then this node may never get called on.</p>
<p>Here is an example of both deciding factors at play:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>behavior evade_threat
   precondition
      Array&lt;WsfPlatform&gt;  mIncoming  =  Array&lt;WsfPlatform&gt;();
      if (PROCESSOR.WeaponsIncoming(mIncoming) &gt; 0)
         return true;
      return false;
   end_precondition
   execute
      extern void Evade(void);
      Evade();
   end_execute
end_behavior

behavior chase_target
   precondition
      if( ! PROCESSOR.Target().IsValid() )
         return false;
      return true;
   end_precondition
   execute
      extern void Chase(WsfTrack);
      Chase( PROCESSOR.Target() );
   end_execute
end_behavior

behavior_tree
   selector
      behavior_node  evade_threat
      behavior_node  chase_target
   end_selector
end_behavior_tree
</pre></div>
</div>
<p>You can see the precondition for the “evade_threat” behavior will only let that behavior execute if there are incoming threats.  You can see the precondition for the “chase_target” behavior will only let that behavior execute if there is a valid target to chase.  Now, looking at how they are arranged in the behavior tree, we can see that the “evade_threat” behavior was set as the first child of its selector node parent.  Whenever the “evade_threat” behavior’s precondition passes that behavior is “selected”, it is executed, and no other children are considered.  In other words, the only time that the “chase_target” behavior will ever be chosen is when there is nothing to evade.  If the tree builder wanted both of these behaviors to be executed, he might have used a sequence node as the parent.</p>
</section>
</section>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  
    <p class="logo"><a href="main_page.html">
      <img class="logo" src="../_static/sidebar_logo.png" alt="Logo"/>
    </a></p>
  

<script src="../_static/extension.js"></script>
<p>
   <ul class="Core-menu">
      <li><a href="main_page.html">Main Page</a></li>
      <li><a href="changelog/afsim_2.9.html">Changelog</a> | <a href="afsim_change_log.html">History</a></li>
      <li><a href="documents.html">Documents</a></li>
      <li><a href="security_info.html">Security Information</a></li>
      <li><a href="contact_info.html">Contact Information</a></li>
   </ul>
</p>

<br>
<hr>
<br>

<p>
   <h3>Core Apps</h3>
   <ul class="Core-menu">
     <li><a href="wsf_core.html">Main Page</a></li>
     <li><a href="wsf_reference_guide.html">Reference Guide</a></li>
     <li><a href="changelog/wsf_2.9.html">Changelog</a> | <a href="wsf_change_log.html">History</a></li>
   </ul>
</p>

<p>
   <h3>Demos</h3>
   <ul class="DEMOS-menu">
     <li><a href="changelog/demos_2.9.html">Changelog</a> | <a href="demos_change_log.html">History</a></li>
   </ul>
</p>

<p>
   <h3>Mystic</h3>
   <ul class="Mystic-menu">
     <li><a href="mystic.html">Main Page</a></li>
     <li><a href="mystic_users_guide.html">User's Guide</a></li>
     <li><a href="mystic_reference_guide.html">Reference Guide</a></li>
     <li><a href="pymystic.html">Batch Processing</a></li>
     <li><a href="changelog/mystic_2.9.html">Changelog</a> | <a href="mystic_change_log.html">History</a></li>
   </ul>
</p>

<p>
   <h3>Warlock</h3>
   <ul class="WARLOCK-menu">
     <li><a href="warlock.html">Main Page</a></li>
     <li><a href="warlock_users_guide.html">User's Guide</a></li>
     <li><a href="warlock_reference_guide.html">Reference Guide</a></li>
     <li><a href="changelog/warlock_2.9.html">Changelog</a> | <a href="warlock_change_log.html">History</a></li>
   </ul>
</p>

<p>
   <h3>Wizard</h3>
   <ul class="WIZARD-menu">
     <li><a href="wizard.html">Main Page</a></li>
     <li><a href="wizard_users_guide.html">User's Guide</a></li>
     <li><a href="wizard_reference_guide.html">Reference Guide</a></li>
     <li><a href="changelog/wizard_2.9.html">Changelog</a> | <a href="wizard_change_log.html">History</a></li>
   </ul>
</p>

<p>
   <h3>EVT Reader</h3>
   <ul class="EvtReader-menu">
     <li><a href="evtreader.html">Main Page</a></li>
   </ul>
</p>

<p>
   <h3>Mover Creator</h3>
   <ul class="MoverCreator-menu">
     <li><a href="mover_creator.html">Main Page</a></li>
     <li><a href="mc_users_guide.html">User's Guide</a></li>
     <li><a href="mc_reference_guide.html">Reference Guide</a></li>
     <li><a href="changelog/mover_creator_2.9.html">Changelog</a> | <a href="mc_change_log.html">History</a></li>
   </ul>
</p>

<br>
<hr>
<br>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/docs/behavior_tree.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="../wsf-classindex.html" title="Script Class Index"
             >classes</a> |</li>
        <li class="right" >
          <a href="../wsf-commandindex.html" title="Command Index"
             >commands</a> |</li>
        <li class="right" >
          <a href="../wsf-modelindex.html" title="Model Index"
             >models</a> |</li>
        <li class="right" >
          <a href="../wsf-demoindex.html" title="Demo Index"
             >demos</a> |</li>
        <li class="right" >
          <a href="behavior_tree_demos.html" title="Behavior Tree Demos"
             >next</a> |</li>
        <li class="right" >
          <a href="behavior.html" title="behavior"
             >previous</a> |</li>
  <li>
    <img src="../_static/relbar_logo.png" alt=""
         style="vertical-align: middle; margin-top: -2px" />
  </li>
  <li>
    <a href="main_page.html">AFSIM 2.9.0 Documentation</a> &#187;
  </li>
  
        <li class="nav-item nav-item-0"><a href="../site_index.html">Site Index</a> &#187;</li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright Multiple, All Rights Reserved.
      Last updated on Feb 25, 2022.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>